<%- include('../layout/user/user_header.ejs') %>

<%- include('../user/user_nav.ejs') %>

<% const inFormat = new Intl.NumberFormat('en-IN' , {style : 'currency' , currency : "INR"}) %>

<div class="container">
    <div class="row">
        <div class="col">
            <section class="h-100 gradient-custom">
                <div class="container py-5 h-100">
                  <div class="row d-flex justify-content-center align-items-center h-100">
                    <div class="col-lg-10 col-xl-8">
                      <div class="card" style="border-radius: 10px;">
                        <div class="card-header px-4 py-5">
                          <h5 class="text-muted mb-0 " id="titleHead">Your <span style="color: #a8729a;">wishlist</span>!</h5>
                        </div>
                        <div id="reloadDiv">

                            <div class="card-body p-4">
                              <div class="card shadow-0 border mb-4">
                                <% wishData.wishlist.forEach((data) =>{ %>
                                    <div class="card-body">
                                      <div class="row">
                                        <div class="col-md-2">
                                          <img src="/product_images/<%= data.productId.images[0] %>"
                                            class="img-fluid" alt="Phone">
                                        </div>
                                        <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                          <p class="text-muted mb-0" id="checkPara"><%= data.productId.name %></p>
                                        </div>
                                        <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                          <p class="text-muted mb-0 small"><span>Price : </span> <%= inFormat.format(data.productId.price) %></p>
                                        </div>
                                        <div class="col-md-3 text-center d-flex justify-content-center align-items-center">
                                          <button class="btn btn-success" onclick="addToCart('<%= data.productId._id %>')">Add to cart</button>
                                        </div>
                                        <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                                          <button class="btn btn-danger" onclick="removeFromWishlist('<%= data.productId._id %>')">Remove</button>
                                        </div>
                                        
                                      </div>
                                    </div>
                                <% }) %>
                              </div>
                          </div>

                        </div>
                    </div>
                  </div>
                </div>
              </section>  
        </div>
    </div>

    <!-- Footer -->
	<footer class="bg3 p-t-50 p-b-32 mt-5">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-lg-3 p-b-30">

					<h4 class="stext-301 cl0 p-b-30">
						Categories
					</h4>

					<ul>
						<% catData.forEach((data) =>{ %>
							<li class="p-b-10">
								<a href="/viewAllProducts/<%=data._id %>" class="stext-107 cl7 hov-cl1 trans-04">
									<%=data.name %>
								</a>
							</li>
						<% }) %>
					</ul>

				</div>

				<div class="col-sm-6 col-lg-3 p-b-30">
					<h4 class="stext-301 cl0 p-b-30">
						Help
					</h4>

					<ul>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Shipping
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								FAQs
							</a>
						</li>
					</ul>
				</div>

				<div class="col-sm-6 col-lg-3 p-b-30">
					<h4 class="stext-301 cl0 p-b-30">
						GET IN TOUCH
					</h4>

					<p class="stext-107 cl7 size-201">
						Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us on (+1) 96 716 6879
					</p>

					<div class="p-t-27">
						<a href="http://www.facebook.com" target="_blank" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-facebook"></i>
						</a>

						<a href="http://www.instagram.com" target="_blank" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-instagram"></i>
						</a>

						<a href="http://www.pinterest.com" target="_blank" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-pinterest-p"></i>
						</a>
					</div>
				</div>

				<div class="col-sm-6 col-lg-3 p-b-30">
					<h4 class="stext-301 cl0 p-b-30">
						Newsletter
					</h4>

					<form>
						<div class="wrap-input1 w-full p-b-4">
							<input class="input1 bg-none plh1 stext-107 cl7" type="text" name="email" placeholder="email@example.com">
							<div class="focus-input1 trans-04"></div>
						</div>

						<div class="p-t-18">
							<button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">
								Subscribe
							</button>
						</div>
					</form>
				</div>
			</div>

			<div class="p-t-40">
				<div class="flex-c-m flex-w p-b-18">
					<a href="#" class="m-all-1">
						<img src="user_assets/images/icons/icon-pay-01.png" alt="ICON-PAY">
					</a>

					<a href="#" class="m-all-1">
						<img src="user_assets/images/icons/icon-pay-02.png" alt="ICON-PAY">
					</a>

					<a href="#" class="m-all-1">
						<img src="user_assets/images/icons/icon-pay-03.png" alt="ICON-PAY">
					</a>

					<a href="#" class="m-all-1">
						<img src="user_assets/images/icons/icon-pay-04.png" alt="ICON-PAY">
					</a>

					<a href="#" class="m-all-1">
						<img src="user_assets/images/icons/icon-pay-05.png" alt="ICON-PAY">
					</a>
				</div>

				<p class="stext-107 cl6 txt-center">
					<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | Pedals India</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->

				</p>
			</div>
		</div>
	</footer>



</div>

<script>

  let addToCart = (proId) => {

    const url = `/addFromWish/${proId}`
    $.ajax(
      {
        url: url,
        method: 'GET',
        data: null,
        success: (response) => {
          console.log(response);
          if (response.success) {
            Swal.fire({
              position: 'center',
              icon: 'success',
              title: 'product added to cart',
              showConfirmButton: false,
              timer: 1500
            })
            setTimeout(() => {
              $('#reloadDiv').load('/viewWishlist #reloadDiv')
            }, 1600)
          } else {
            const Toast = Swal.mixin({
              toast: true,
              position: 'center',
              showConfirmButton: false,
              timer: 1500,
              timerProgressBar: true,
              didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
              }
            })

            Toast.fire({
              title: 'Product is already in the cart'
            })
          }
        }
      }
    )
  }

  let removeFromWishlist = (proId) => {

    Swal.fire({
      title: 'Are you sure?',
      text: "Remove product from wishlist?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, remove it!'
    }).then((result) => {
      if (result.isConfirmed) {

        $.ajax(
          {
            url: `/removeFromWishlist/${proId}`,
            method: "get",
            data: null,
            success: (response) => {
              console.log(response);
              Swal.fire({
                position: 'center',
                icon: 'success',
                title: 'Removed from wish list',
                showConfirmButton: false,
                timer: 2500
              })
              setTimeout(() => {
                $('#reloadDiv').load('/viewWishlist #reloadDiv')
              }, 1000)
            }
          }
        )

      }
    })


  }

  $(document).ready(() => {
    const check = document.getElementById('checkPara')
    const titleHead = document.getElementById('titleHead')
    if (!check) {
      titleHead.innerHTML = 'There is nothing here!!'
      titleHead.style.color = "Green"
      // titleHead.style.textAlign('center')
      document.getElementById('reloadDiv').remove()
    }
  })


</script>




<%- include('../layout/user/user_footer.ejs') %>